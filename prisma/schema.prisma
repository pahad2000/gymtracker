generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  password      String
  themeMode     String    @default("auto") // auto, light, dark

  // 2FA fields
  twoFactorEnabled    Boolean   @default(false)
  twoFactorCode       String?
  twoFactorExpires    DateTime?

  // Email preferences
  weeklyEmailsEnabled Boolean   @default(true)

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  workouts         Workout[]
  workoutSessions  WorkoutSession[]
  workoutCycles    WorkoutCycle[]

  @@map("users")
}

model WorkoutCycle {
  id            String    @id @default(cuid())
  name          String

  // Schedule for the cycle
  intervalDays  Int?      // Every n days (null if using specific days)
  scheduleDays  Int[]     // Array of weekday numbers [0-6]
  startDate     DateTime  @default(now())

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  userId        String
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  workouts      Workout[]

  @@index([userId])
  @@map("workout_cycles")
}

model Workout {
  id            String    @id @default(cuid())
  name          String
  workoutType   String    @default("weight") // "weight" or "time"
  weight        Float     // Weight in kg/lbs (or duration in seconds for time-based)
  restTime      Int       // Rest time in seconds
  sets          Int       // Number of sets
  repsPerSet    Int       // Reps per set (or duration per set for time-based)
  notes         String?
  aiTip         String?   @db.Text
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Schedule for standalone workouts (ignored if part of a cycle)
  intervalDays  Int?      // Every n days (null if using specific days)
  scheduleDays  Int[]     // Array of weekday numbers [0-6]
  startDate     DateTime  @default(now())

  // Cycle membership (optional)
  cycleId       String?
  cycle         WorkoutCycle? @relation(fields: [cycleId], references: [id], onDelete: Cascade)
  cycleOrder    Int?      // Order within the cycle (0, 1, 2, ...)

  displayOrder  Int       @default(0)  // Manual ordering for Today page

  userId        String
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  sessions      WorkoutSession[]

  @@index([userId])
  @@index([userId, displayOrder])
  @@map("workouts")
}

model WorkoutSession {
  id              String    @id @default(cuid())
  date            DateTime  @default(now())
  completed       Boolean   @default(false)
  setsCompleted   Int       @default(0)
  repsPerSet      Int[]     // Actual reps done per set
  weightUsed      Float?
  duration        Int?      // Duration in seconds

  workoutId       String
  workout         Workout   @relation(fields: [workoutId], references: [id], onDelete: Cascade)

  userId          String
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, date])
  @@index([workoutId])
  @@map("workout_sessions")
}
